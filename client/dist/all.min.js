var AppView=Backbone.View.extend({initialize:function(){this.headerView=new HeaderView({model:this.model.get("header")}),this.schoolView=new SchoolView({collection:this.model.get("school")}),this.loanView=new LoanView({model:this.model.get("loan")}),this.stateView=new StateView({collection:this.model.get("state")})},className:"container",render:function(){return this.$el.html([this.headerView.$el,this.stateView.$el,this.schoolView.$el,this.loanView.$el])}}),HeaderView=Backbone.View.extend({initialize:function(){this.render()},render:function(){return this.$el.html("<h1>"+this.model.get("title")+"</h1>")}}),LoanView=Backbone.View.extend({initialize:function(e){this.render()},render:function(){return this.$el.html("<p>Loans Go here</p>")}}),SchoolEntryView=Backbone.View.extend({tagName:"tr",events:{click:"removeMe"},removeMe:function(){console.log(this),this.$el.remove()},template:_.template("<td><%= name %></td><td><%= state %></td>"),render:function(){return this.$el.html(this.template(this.model.attributes))}}),SchoolView=Backbone.View.extend({initialize:function(){this.render(),this.on("clickme",function(){console.log(this)}),this.collection.on("sync",this.autoblah,this)},events:{"click button":"addSchools","submit form":"findSchool"},addSchools:function(){this.collection;this.$el.find("table").append(this.collection.map(function(e){return new SchoolEntryView({model:e}).render()}))},autoblah:function(){var e=this.collection.map(function(e){return e.get("name")}),t=function(e){return function(t,n){var i;i=[],substrRegex=new RegExp(t,"i"),$.each(e,function(e,t){substrRegex.test(t)&&i.push(t)}),n(i)}};$("#the-basics .typeahead").typeahead({hint:!0,highlight:!0,minLength:1},{name:"states",source:t(e)})},findSchool:function(e){e.preventDefault();var t=$(".tt-input").typeahead("val");t=t.toUpperCase(),t=t.trim(),this.collection.forEach(function(e){e.get("name").trim()}),this.render(),this.autoblah()},render:function(){return this.$el.html('<form id="the-basics">				<label>School Name: </label>				<input type="text" class="typeahead" placeholder="Enter School Here..." />				<input type="submit" value="Find School" />			</form>')}}),StateView=Backbone.View.extend({initialize:function(){this.render(),this.displayMap()},className:"chart",displayMap:function(){var e,t=this,n=960,i=500,a=d3.geo.albersUsa().scale(1070).translate([n/2,i/2]),o=d3.geo.path().projection(a),s=d3.select(t.el).append("svg").attr("width",n).attr("height",i);s.append("rect").attr("class","background").attr("width",n).attr("height",i).on("click",r);var l=s.append("g");d3.json("/assets/us.json",function(e,t){if(e)throw e;l.append("g").attr("id","states").selectAll("path").data(topojson.feature(t,t.objects.units).features).enter().append("path").attr("d",o).attr("state",function(e){return e.properties.name}).on("click",r),l.append("path").datum(topojson.mesh(t,t.objects.units,function(e,t){return e!==t})).attr("id","states-borders").attr("d",o)});var r=function(a){var s=$(this).attr("state"),r=t.collection.calcAverages(s);$(".results").html("<h3>"+s+"</h3>								<p>Average Per Recipient: $"+r.average+"</p>");var c,h,d;if(a&&e!==a){var u=o.centroid(a);c=u[0],h=u[1],d=8,e=a}else c=n/2,h=i/2,d=1,e=null;l.selectAll("path").classed("active",e&&function(t){return t===e}),l.transition().duration(750).attr("transform","translate("+n/2+","+i/2+")scale("+d+")translate("+-c+","+-h+")").style("stroke-width",1.5/d+"px")}},render:function(){return this.$el.html("<h2>State View</h2><div class='results'></div>")}}),Schools=Backbone.Collection.extend({model:SchoolModel,url:"/schools",initialize:function(){this.fetch({success:function(e){console.log(e)},error:function(e){console.log(e)}})}}),States=Backbone.Collection.extend({model:StateModel,url:"/states",initialize:function(){this.fetch({success:function(e){},error:function(e){console.log(e)}})},calcAverages:function(e){var t=this,n={totalDollar:0,totalRecipients:0};return this.map(function(i){t.stateHash[e]===i.get("state")&&(n.totalDollar+=i.get("totaldollars"),n.totalRecipients+=i.get("totalrecipients"))}),n.average=Math.round(n.totalDollar/n.totalRecipients),n},stateHash:{Alabama:"AL",Alaska:"AK","American Samoa":"AS",Arizona:"AZ",Arkansas:"AR",California:"CA",Colorado:"CO",Connecticut:"CT",Delaware:"DE","District Of Columbia":"DC","Federated States Of Micronesia":"FM",Florida:"FL",Georgia:"GA",Guam:"GU",Hawaii:"HI",Idaho:"ID",Illinois:"IL",Indiana:"IN",Iowa:"IA",Kansas:"KS",Kentucky:"KY",Louisiana:"LA",Maine:"ME","Marshall Islands":"MH",Maryland:"MD",Massachusetts:"MA",Michigan:"MI",Minnesota:"MN",Mississippi:"MS",Missouri:"MO",Montana:"MT",Nebraska:"NE",Nevada:"NV","New Hampshire":"NH","New Jersey":"NJ","New Mexico":"NM","New York":"NY","North Carolina":"NC","North Dakota":"ND","Northern Mariana Islands":"MP",Ohio:"OH",Oklahoma:"OK",Oregon:"OR",Palau:"PW",Pennsylvania:"PA","Puerto Rico":"PR","Rhode Island":"RI","South Carolina":"SC","South Dakota":"SD",Tennessee:"TN",Texas:"TX",Utah:"UT",Vermont:"VT","Virgin Islands":"VI",Virginia:"VA",Washington:"WA","West Virginia":"WV",Wisconsin:"WI",Wyoming:"WY"}}),AppModel=Backbone.Model.extend({initialize:function(){this.set("school",new Schools),this.set("state",new States),this.set("loan",new LoanModel),this.set("header",new HeaderModel)}}),HeaderModel=Backbone.Model.extend({initialize:function(){this.set("title","Student Loan Size for 2nd Quarter 2015")}}),LoanModel=Backbone.Model.extend({urlRoot:"/loans",initialize:function(){}}),SchoolModel=Backbone.Model.extend({urlRoot:"/schools",initialize:function(){}}),StateModel=Backbone.Model.extend({urlRoot:"/states"});